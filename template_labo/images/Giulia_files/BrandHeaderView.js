"use strict";YUI.add("rg-header-notify",function(i){i.namespace("rg.widget"),i.rg.notify=function(e,t){return i.fire("emitLegacyNotification",e,t)},i.rg.flushAlerts=function(){return i.fire("flushLegacyNotifications")}},"0.0.1",{requires:[]});
YUI.add("rg-autocomplete",function(e){var t,a,s,o;function l(e){e.inputNode=e.host,e.render||!1===e.render||(e.render=!0),l.superclass.constructor.apply(this,arguments)}e.namespace("rg.autocomplete"),t=e.Base.create("LoadingPlugin",e.Plugin.Base,[],{_queryHandle:null,_resultsHandle:null,_clearHandle:null,initializer:function(){var e=this.get("host"),t=e.get("inputNode"),a=this.get("loadingClassOn"),s=this.get("loadingClassOff");t.addClass(s),this._queryHandle=e.on("query",function(){t.removeClass(s),t.addClass(a)},this),this._resultsHandle=e.on("results",function(){t.removeClass(a),t.addClass(s)},this),this._clearHandle=e.on("clear",function(){t.removeClass(a),t.addClass(s)},this)},destructor:function(){this._queryHandle.detach(),this._resultsHandle.detach(),this._clearHandle.detach()}},{NS:"autocompleteLoadingPlugin",ATTRS:{loadingClassOn:{value:"ajax-loading"},loadingClassOff:{value:""}}}),o="activeItem",s=e.Base.create("ChangeActiveOnHover",e.Plugin.Base,[],{initializer:function(){this.beforeHostMethod("_afterMouseOver",this._afterMouseOver,this.get("host")),this.beforeHostMethod("_afterMouseOut",this._afterMouseLeave,this.get("host"))},_afterMouseOver:function(e){var t=e.domEvent.target.ancestor(this._SELECTOR_ITEM,!0);t&&this._set(o,t)},_afterMouseLeave:function(){this._set(o,null)}},{NS:"changeActiveOnHover"}),a=e.Base.create("aclist",e.AutoCompleteList,[],{initializer:function(){this.plug(s),this.plug(t,{loadingClassOn:"ac-ajax-loadingon",loadingClassOff:"ac-ajax-loadingoff"})}},{}),e.extend(l,a,{},{NAME:"autocompleteListPlugin",NS:"ac",CSS_PREFIX:e.ClassNameManager.getClassName("aclist")}),e.rg.autocomplete.LoadingPlugin=t,e.rg.autocomplete.ChangeActiveOnHover=s,e.rg.autocomplete.AutoComplete=a,e.rg.autocomplete.AutoCompletePlugin=l},"0.0.1",{requires:["autocomplete","autocomplete-list","autocomplete-highlighters","autocomplete-filters","node-pluginhost"]});
YUI.add("rg.core.autocomplete.AlignNode",function(e){e.namespace("rg.core.autocomplete"),e.rg.core.autocomplete.AlignNode=e.Base.create("AlignNode",e.Plugin.Base,[],{initializer:function(){"autocompleteListPlugin"==this.get("host").name?this.align():e.log("Y.rg.core.autocomplete.AlignNode must be plugged on autocompleteListPlugin")},align:function(){var e=this.get("host");e.set("align",{node:this.get("node"),points:["tl","bl"]}),e.set("width",this.get("node").get("offsetWidth"))}},{NS:"AlignNode",ATTRS:{node:{value:null}}})},"0.0.1",{requires:[]});
YUI.add("rg.core.autocomplete.ToggleLoadingState",function(e){e.namespace("rg.core.autocomplete"),e.rg.core.autocomplete.ToggleLoadingState=e.Base.create("ToggleLoadingState",e.Plugin.Base,[],{initializer:function(){var t=this.get("host");"autocompleteListPlugin"==t.name?(t.on("query",function(){this.toggleLoadingState(!0)},this),t.on(["results","clear"],function(){this.toggleLoadingState(!1)},this)):e.log("Y.rg.core.autocomplete.ToggleLoadingState must be plugged on autocompleteListPlugin")},toggleLoadingState:function(e){e?this.get("node").addClass(this.get("loadingClass")):this.get("node").removeClass(this.get("loadingClass"))}},{NS:"ToggleLoadingState",ATTRS:{node:{value:null},loadingClass:{value:"search-loading"}}})},"0.0.1",{requires:[]});
YUI.add("rg.views.application.BrandHeaderView",function(e){e.namespace("rg.views.application"),e.rg.views.application.BrandHeaderView=e.Base.create("application.BrandHeaderView",e.rg.WidgetView,[],{events:{".js-filter-item":{click:"selectSearchFilter"},".js-invite-colleagues":{click:"showInviteDialog"},global:{"editImage:imageChanged":"onProfileImageChanged","BrandHeaderView::dropdownToggled":"dropdownClick"},".js-dropdown-toggle[aria-expanded]":{click:"dropdownToggled"},".js-log-out":{click:"onLogOut"}},afterRendered:function(){this.data.isLoggedInViaTrustedDevice&&e.rg.notify("You logged in to ResearchGate with a trusted device. Manage devices in security settings.","attention");var t=this.get("container"),a=t.one(".js-search-input"),i=t.one(".js-search-wrapper");if(this.attachDropdowns(),this.get("openHeaderMenu")){var o=t.one(".notification-"+this.get("openHeaderMenu"));o&&o.one(".js-dropdown-toggle").simulate("click")}if(a&&(a.on("focus",function(){this._trackTypeSelectorUsage()},this),i&&(i.on("mouseenter",function(){t.addClass("searchhover")}),i.on("mouseleave",function(){t.removeClass("searchhover")}),i.on("focus",function(){t.addClass("searchactive"),t.removeClass("searchinactive")},this),i.on("blur",function(){t.removeClass("searchactive"),t.addClass("searchinactive")})),this._searchNode=a,this.initAutoComplete()),this.data.isUser){var n=t.one(".notification-updates .notification-link");n&&n.once("click",function(){e.rg.ajax("application.AjaxCommon.ajaxScoreGoal.html",{goal:this.data.goalUpdated})},this),t.one(".notification-messages .notification-link").once("click",function(){e.rg.ajax("application.AjaxCommon.ajaxScoreGoal.html",{goal:this.data.goalMessages})},this),t.one(".notification-requests .notification-link").once("click",function(){e.rg.ajax("application.AjaxCommon.ajaxScoreGoal.html",{goal:this.data.goalRequests})},this)}widgetLoader.loadAndRenderAsyncWidget(this.get("container").one(".js-delayed-alert-container"),{innerWidgetUrl:"application.DelayedAlert.html"})},attachDropdowns:function(){this.get("container").all(".js-dropdown").plug(e.rg.plugin.DropdownPlugin,{ignoreInsideClick:!0,ignoreLinks:!0,activatorSelector:".js-dropdown-toggle",deactivatorSelector:"#page-container",callbackOnOpen:function(t,a){a&&a.preventDefault();var i=t.get("host");if(i.hasClass("notification-item")){var o=i.getData("seen-event");o&&e.fire(o);var n=i.one(".js-requests-container"),r=n.getData("was-rendered");if(n&&!r){var s=i.getData("content-url");widgetLoader.loadWidget(s,{},function(e){e.render({replaceContent:n}),n.setData("was-rendered",!0)})}}}})},_trackTypeSelectorUsage:function(){e.rg.ajax(this.data.trackTypeUsageEndpoint,{type:this._selectedType},function(){},this,null,"POST")},selectSearchFilter:function(e){if(e&&e.currentTarget){var t=e.currentTarget.getData("ico"),a=e.currentTarget.getData("value"),i=e.currentTarget.getData("placeholder"),o=this.get("container");o.all(".search-filter .filter-item").removeClass("active"),e.currentTarget.ancestor(".filter-item").addClass("active"),o.one(".js-type-input").set("value",a),o.one(".js-search-input").set("placeholder",i),o.one(".js-search-ico").setAttribute("class","js-search-ico header-ico-combined "+t);var n=this.data.searchTypes[a];""==n.ajaxSource?this._searchNode.ac.set("minQueryLength",1e8):this._searchNode.ac.set("minQueryLength",this.get("minQueryLength")),this._searchNode.ac.set("source",n.ajaxSource),this._searchNode.ac.clearCache()}this._searchNode.focus()},initAutoComplete:function(){var t=widgetRenderer.getStub("application/stubs/partials/headerSearchResultItem.html"),a=widgetRenderer.getStub("application/stubs/partials/headerSearchMore.html"),i=widgetRenderer.createHoganTemplate(t.compiledTemplate,t.templateString),o=widgetRenderer.createHoganTemplate(a.compiledTemplate,a.templateString);this._searchNode.plug(e.Plugin.AutoComplete,{resultFormatter:function(t,a){return e.Array.map(a,function(e){var t=e.raw,a=e.highlighted?e.highlighted:e.display;return i.render({highlighted:"<noscript></noscript>"+a,text:e.text,img_url:t.image,additional:t.institution})})},resultHighlighter:"phraseMatch",resultListLocator:"result",resultTextLocator:"name",queryDelay:200,minQueryLength:2,maxResults:16,activateFirstItem:!1,render:!0,align:{node:this.get("container").one(".js-search-wrapper"),points:["tr","br"]},width:420,plugins:[e.rg.autocomplete.ChangeActiveOnHover,{fn:e.rg.core.autocomplete.ToggleLoadingState,cfg:{node:this.get("container").one(".js-search-wrapper"),loadingClass:"search-loading"}}],source:this.data.defaultType.ajaxSource}),this._searchNode.ac.on("select",this.selectItem,this);var n=this._searchNode.ac.get("contentBox"),r=e.Node.create('<div class="dropdown-title js-dropdown-title"></div>');r.set("text",this.data.defaultType.label),n.insert(r,0),n.append('<div class="view-all-btn"></div>'),this._searchNode.ac.on("results",function(e){var t=o.render({text:e.query,viewId:this.data.viewId,autoSelectedType:this.data.autoSelectedType});n.one(".view-all-btn").setContent(t)},this)},selectItem:function(t){e.rg.utils.url.forwardTo(t.result.raw.url)},showInviteDialog:function(){widgetLoader.loadWidgetInDialog(this.get("inviteDialogUrl")),e.rg.ajax("application.AjaxCommon.ajaxScoreGoal.html",{goal:this.data.goalHeaderInviteClicked})},onProfileImageChanged:function(){this.reload()},dropdownToggled:function(e){var t=e.currentTarget._node;t.setAttribute("aria-expanded","false"===t.getAttribute("aria-expanded")?"true":"false")},dropdownClick:function(){var e=this.get("container").one(".js-profile-item");e&&e.one(".js-dropdown-toggle").simulate("click")},onLogOut:function(){e.fire("BrandHeader:logOut")}},{ATTRS:{minQueryLength:{value:2},profileTooltipHidden:{value:!1},inviteDialogUrl:{},openHeaderMenu:{}}})},"1.0.0",{requires:["rg-header-notify","rg-dropdown-plugin","rg-autocomplete","rg.core.autocomplete.AlignNode","rg.core.autocomplete.ToggleLoadingState","application/stubs/partials/headerSearchMore.html","application/stubs/partials/headerSearchResultItem.html","node-event-simulate"]});
