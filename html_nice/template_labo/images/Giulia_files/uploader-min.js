YUI.add("file-html5",function(a,b){var c=(a.Lang,a.bind),d=a.config.win,e=function(a){var b=null;b=e.isValidFile(a)?a:!!e.isValidFile(a.file)&&a.file,e.superclass.constructor.apply(this,arguments),b&&e.canUpload()&&(this.get("file")||this._set("file",b),this.get("name")||this._set("name",b.name||b.fileName),this.get("size")!=(b.size||b.fileSize)&&this._set("size",b.size||b.fileSize),this.get("type")||this._set("type",b.type),b.hasOwnProperty("lastModifiedDate")&&!this.get("dateModified")&&this._set("dateModified",b.lastModifiedDate))};a.extend(e,a.Base,{initializer:function(b){this.get("id")||this._set("id",a.guid("file"))},_uploadEventHandler:function(a){var b=this.get("xhr");switch(a.type){case"progress":this.fire("uploadprogress",{originEvent:a,bytesLoaded:a.loaded,bytesTotal:this.get("size"),percentLoaded:Math.min(100,Math.round(1e4*a.loaded/this.get("size"))/100)}),this._set("bytesUploaded",a.loaded);break;case"load":if(b.status>=200&&b.status<=299){this.fire("uploadcomplete",{originEvent:a,data:a.target.responseText});var c=b.upload,d=this.get("boundEventHandler");c.removeEventListener("progress",d),c.removeEventListener("error",d),c.removeEventListener("abort",d),b.removeEventListener("load",d),b.removeEventListener("error",d),b.removeEventListener("readystatechange",d),this._set("xhr",null)}else this.fire("uploaderror",{originEvent:a,data:b.responseText,status:b.status,statusText:b.statusText,source:"http"});break;case"error":this.fire("uploaderror",{originEvent:a,data:b.responseText,status:b.status,statusText:b.statusText,source:"io"});break;case"abort":this.fire("uploadcancel",{originEvent:a});break;case"readystatechange":this.fire("readystatechange",{readyState:a.target.readyState,originEvent:a})}},startUpload:function(b,d,e){this._set("bytesUploaded",0),this._set("xhr",new XMLHttpRequest),this._set("boundEventHandler",c(this._uploadEventHandler,this));var f=new FormData,g=e||"Filedata",h=this.get("xhr"),i=this.get("xhr").upload,j=this.get("boundEventHandler");a.each(d,function(a,b){f.append(b,a)}),f.append(g,this.get("file")),h.addEventListener("loadstart",j,!1),i.addEventListener("progress",j,!1),h.addEventListener("load",j,!1),h.addEventListener("error",j,!1),i.addEventListener("error",j,!1),i.addEventListener("abort",j,!1),h.addEventListener("abort",j,!1),h.addEventListener("loadend",j,!1),h.addEventListener("readystatechange",j,!1),h.open("POST",b,!0),h.withCredentials=this.get("xhrWithCredentials"),a.each(this.get("xhrHeaders"),function(a,b){h.setRequestHeader(b,a)}),h.send(f),this.fire("uploadstart",{xhr:h})},cancelUpload:function(){var a=this.get("xhr");a&&a.abort()}},{NAME:"file",TYPE:"html5",ATTRS:{id:{writeOnce:"initOnly",value:null},size:{writeOnce:"initOnly",value:0},name:{writeOnce:"initOnly",value:null},dateCreated:{writeOnce:"initOnly",value:null},dateModified:{writeOnce:"initOnly",value:null},bytesUploaded:{readOnly:!0,value:0},type:{writeOnce:"initOnly",value:null},file:{writeOnce:"initOnly",value:null},xhr:{readOnly:!0,value:null},xhrHeaders:{value:{}},xhrWithCredentials:{value:!0},boundEventHandler:{readOnly:!0,value:null}},isValidFile:function(a){return d&&d.File&&a instanceof File},canUpload:function(){return d&&d.FormData&&d.XMLHttpRequest}}),a.FileHTML5=e},"3.14.1",{requires:["base"]});
YUI.add("uploader-queue",function(a,b){var c=function(){this.queuedFiles=[],this.uploadRetries={},this.numberOfUploads=0,this.currentUploadedByteValues={},this.currentFiles={},this.totalBytesUploaded=0,this.totalBytes=0,c.superclass.constructor.apply(this,arguments)};a.extend(c,a.Base,{_currentState:c.STOPPED,initializer:function(){},_uploadStartHandler:function(a){var b=a;b.file=a.target,b.originEvent=a,this.fire("uploadstart",b)},_uploadErrorHandler:function(a){var b,d,e=this.get("errorAction"),f=a;f.file=a.target,f.originEvent=a,this.numberOfUploads-=1,delete this.currentFiles[a.target.get("id")],this._detachFileEvents(a.target),a.target.cancelUpload(),e===c.STOP?this.pauseUpload():e===c.RESTART_ASAP?(b=a.target.get("id"),d=this.uploadRetries[b]||0,d<this.get("retryCount")&&(this.uploadRetries[b]=d+1,this.addToQueueTop(a.target)),this._startNextFile()):e===c.RESTART_AFTER&&(b=a.target.get("id"),d=this.uploadRetries[b]||0,d<this.get("retryCount")&&(this.uploadRetries[b]=d+1,this.addToQueueBottom(a.target)),this._startNextFile()),this.fire("uploaderror",f)},_startNextFile:function(){if(this.queuedFiles.length>0){var a=this.queuedFiles.shift(),b=a.get("id"),c=this.get("perFileParameters"),d=c.hasOwnProperty(b)?c[b]:c;this.currentUploadedByteValues[b]=0,a.on("uploadstart",this._uploadStartHandler,this),a.on("uploadprogress",this._uploadProgressHandler,this),a.on("uploadcomplete",this._uploadCompleteHandler,this),a.on("uploaderror",this._uploadErrorHandler,this),a.on("uploadcancel",this._uploadCancelHandler,this),a.set("xhrHeaders",this.get("uploadHeaders")),a.set("xhrWithCredentials",this.get("withCredentials")),a.startUpload(this.get("uploadURL"),d,this.get("fileFieldName")),this._registerUpload(a)}},_registerUpload:function(a){this.numberOfUploads+=1,this.currentFiles[a.get("id")]=a},_unregisterUpload:function(a){this.numberOfUploads>0&&(this.numberOfUploads-=1),delete this.currentFiles[a.get("id")],delete this.uploadRetries[a.get("id")],this._detachFileEvents(a)},_detachFileEvents:function(a){a.detach("uploadstart",this._uploadStartHandler),a.detach("uploadprogress",this._uploadProgressHandler),a.detach("uploadcomplete",this._uploadCompleteHandler),a.detach("uploaderror",this._uploadErrorHandler),a.detach("uploadcancel",this._uploadCancelHandler)},_uploadCompleteHandler:function(b){this._unregisterUpload(b.target),this.totalBytesUploaded+=b.target.get("size"),delete this.currentUploadedByteValues[b.target.get("id")],this.queuedFiles.length>0&&this._currentState===c.UPLOADING&&this._startNextFile();var d=b,e=this.totalBytesUploaded,f=Math.min(100,Math.round(1e4*e/this.totalBytes)/100);d.file=b.target,d.originEvent=b,a.each(this.currentUploadedByteValues,function(a){e+=a}),this.fire("totaluploadprogress",{bytesLoaded:e,bytesTotal:this.totalBytes,percentLoaded:f}),this.fire("uploadcomplete",d),0===this.queuedFiles.length&&this.numberOfUploads<=0&&(this.fire("alluploadscomplete"),this._currentState=c.STOPPED)},_uploadCancelHandler:function(a){var b=a;b.originEvent=a,b.file=a.target,this.fire("uploadcancel",b)},_uploadProgressHandler:function(b){this.currentUploadedByteValues[b.target.get("id")]=b.bytesLoaded;var c=b,d=this.totalBytesUploaded,e=Math.min(100,Math.round(1e4*d/this.totalBytes)/100);c.originEvent=b,c.file=b.target,this.fire("uploadprogress",c),a.each(this.currentUploadedByteValues,function(a){d+=a}),this.fire("totaluploadprogress",{bytesLoaded:d,bytesTotal:this.totalBytes,percentLoaded:e})},startUpload:function(){for(this.queuedFiles=this.get("fileList").slice(0),this.numberOfUploads=0,this.currentUploadedByteValues={},this.currentFiles={},this.totalBytesUploaded=0,this._currentState=c.UPLOADING;this.numberOfUploads<this.get("simUploads")&&this.queuedFiles.length>0;)this._startNextFile()},pauseUpload:function(){this._currentState=c.STOPPED},restartUpload:function(){for(this._currentState=c.UPLOADING;this.numberOfUploads<this.get("simUploads");)this._startNextFile()},forceReupload:function(a){var b=a.get("id");this.currentFiles.hasOwnProperty(b)&&(a.cancelUpload(),this._unregisterUpload(a),this.addToQueueTop(a),this._startNextFile())},addToQueueTop:function(a){this.queuedFiles.unshift(a)},addToQueueBottom:function(a){this.queuedFiles.push(a)},cancelUpload:function(a){var b,d,e;if(a){if(b=a.get("id"),this.currentFiles[b])this.currentFiles[b].cancelUpload(),this._unregisterUpload(this.currentFiles[b]),this._currentState===c.UPLOADING&&this._startNextFile();else for(d=0,len=this.queuedFiles.length;d<len;d++)if(this.queuedFiles[d].get("id")===b){this.queuedFiles.splice(d,1);break}}else{for(e in this.currentFiles)this.currentFiles[e].cancelUpload(),this._unregisterUpload(this.currentFiles[e]);this.currentUploadedByteValues={},this.currentFiles={},this.totalBytesUploaded=0,this.fire("alluploadscancelled"),this._currentState=c.STOPPED}}},{CONTINUE:"continue",STOP:"stop",RESTART_ASAP:"restartasap",RESTART_AFTER:"restartafter",STOPPED:"stopped",UPLOADING:"uploading",NAME:"uploaderqueue",ATTRS:{simUploads:{value:2,validator:function(a){return a>=1&&a<=5}},errorAction:{value:"continue",validator:function(a){return a===c.CONTINUE||a===c.STOP||a===c.RESTART_ASAP||a===c.RESTART_AFTER}},bytesUploaded:{readOnly:!0,value:0},bytesTotal:{readOnly:!0,value:0},fileList:{value:[],lazyAdd:!1,setter:function(b){var c=b;return a.Array.each(c,function(a){this.totalBytes+=a.get("size")},this),b}},fileFieldName:{value:"Filedata"},uploadURL:{value:""},uploadHeaders:{value:{}},withCredentials:{value:!0},perFileParameters:{value:{}},retryCount:{value:3}}}),a.namespace("Uploader"),a.Uploader.Queue=c},"3.14.1",{requires:["base"]});
YUI.add("uploader-html5",function(a,b){function c(){c.superclass.constructor.apply(this,arguments)}var d=a.Lang.sub,e=a.Uploader.Queue;a.UploaderHTML5=a.extend(c,a.Widget,{_fileInputField:null,_buttonBinding:null,queue:null,initializer:function(){this._fileInputField=null,this.queue=null,this._buttonBinding=null,this._fileList=[],this.publish("fileselect"),this.publish("uploadstart"),this.publish("fileuploadstart"),this.publish("uploadprogress"),this.publish("totaluploadprogress"),this.publish("uploadcomplete"),this.publish("alluploadscomplete"),this.publish("uploaderror"),this.publish("dragenter"),this.publish("dragover"),this.publish("dragleave"),this.publish("drop")},renderUI:function(){var b=this.get("contentBox"),d=this.get("selectFilesButton"),e=a.one("#"+this.get("fileInputId"));d.setStyles({width:"100%",height:"100%"}),b.append(d),this._fileInputField=e||a.Node.create(c.HTML5FILEFIELD_TEMPLATE),b.append(this._fileInputField)},bindUI:function(){this._bindSelectButton(),this._setMultipleFiles(),this._setFileFilters(),this._bindDropArea(),this._triggerEnabled(),this.after("multipleFilesChange",this._setMultipleFiles,this),this.after("fileFiltersChange",this._setFileFilters,this),this.after("enabledChange",this._triggerEnabled,this),this.after("selectFilesButtonChange",this._bindSelectButton,this),this.after("dragAndDropAreaChange",this._bindDropArea,this),this.after("tabIndexChange",function(){this.get("selectFilesButton").set("tabIndex",this.get("tabIndex"))},this),this._fileInputField.on("change",this._updateFileList,this),this._fileInputField.on("click",function(a){a.stopPropagation()},this),this.get("selectFilesButton").set("tabIndex",this.get("tabIndex"))},_rebindFileField:function(){this._fileInputField.remove(!0),this._fileInputField=a.Node.create(c.HTML5FILEFIELD_TEMPLATE),this.get("contentBox").append(this._fileInputField),this._fileInputField.on("change",this._updateFileList,this),this._setMultipleFiles(),this._setFileFilters()},_bindDropArea:function(a){var b=a||{prevVal:null},c=this.get("dragAndDropArea");null!==b.prevVal&&(b.prevVal.detach("drop",this._ddEventHandler),b.prevVal.detach("dragenter",this._ddEventHandler),b.prevVal.detach("dragover",this._ddEventHandler),b.prevVal.detach("dragleave",this._ddEventHandler)),null!==c&&(c.on("drop",this._ddEventHandler,this),c.on("dragenter",this._ddEventHandler,this),c.on("dragover",this._ddEventHandler,this),c.on("dragleave",this._ddEventHandler,this))},_bindSelectButton:function(){this._buttonBinding=this.get("selectFilesButton").on("click",this.openFileSelectDialog,this)},_ddEventHandler:function(b){if(b.stopPropagation(),b.preventDefault(),a.Array.indexOf(b._event.dataTransfer.types,"Files")>-1)switch(b.type){case"dragenter":this.fire("dragenter");break;case"dragover":this.fire("dragover");break;case"dragleave":this.fire("dragleave");break;case"drop":var c,d=b._event.dataTransfer.files,e=[],f=this.get("fileFilterFunction");f?a.each(d,function(b){var c=new a.FileHTML5(b);f(c)&&e.push(c)}):a.each(d,function(b){e.push(new a.FileHTML5(b))}),e.length>0&&(c=this.get("fileList"),this.set("fileList",this.get("appendNewFiles")?c.concat(e):e),this.fire("fileselect",{fileList:e})),this.fire("drop",{fileList:e})}},_setButtonClass:function(a,b){b?this.get("selectFilesButton").addClass(this.get("buttonClassNames")[a]):this.get("selectFilesButton").removeClass(this.get("buttonClassNames")[a])},_setMultipleFiles:function(){!0===this.get("multipleFiles")?this._fileInputField.set("multiple","multiple"):this._fileInputField.set("multiple","")},_setFileFilters:function(){this.get("fileFilters").length>0?this._fileInputField.set("accept",this.get("fileFilters").join(",")):this._fileInputField.set("accept","")},_triggerEnabled:function(){this.get("enabled")&&null===this._buttonBinding?(this._bindSelectButton(),this._setButtonClass("disabled",!1),this.get("selectFilesButton").setAttribute("aria-disabled","false")):!this.get("enabled")&&this._buttonBinding&&(this._buttonBinding.detach(),this._buttonBinding=null,this._setButtonClass("disabled",!0),this.get("selectFilesButton").setAttribute("aria-disabled","true"))},_getFileList:function(){return this._fileList.concat()},_setFileList:function(a){return this._fileList=a.concat(),this._fileList.concat()},_updateFileList:function(b){var c,d=b.target.getDOMNode().files,e=[],f=this.get("fileFilterFunction");f?a.each(d,function(b){var c=new a.FileHTML5(b);f(c)&&e.push(c)}):a.each(d,function(b){e.push(new a.FileHTML5(b))}),e.length>0&&(c=this.get("fileList"),this.set("fileList",this.get("appendNewFiles")?c.concat(e):e),this.fire("fileselect",{fileList:e})),this._rebindFileField()},_uploadEventHandler:function(a){switch(a.type){case"file:uploadstart":this.fire("fileuploadstart",a);break;case"file:uploadprogress":this.fire("uploadprogress",a);break;case"uploaderqueue:totaluploadprogress":this.fire("totaluploadprogress",a);break;case"file:uploadcomplete":this.fire("uploadcomplete",a);break;case"uploaderqueue:alluploadscomplete":this.queue=null,this.fire("alluploadscomplete",a);break;case"file:uploaderror":case"uploaderqueue:uploaderror":this.fire("uploaderror",a);break;case"file:uploadcancel":case"uploaderqueue:uploadcancel":this.fire("uploadcancel",a)}},openFileSelectDialog:function(){var a=this._fileInputField.getDOMNode();a.click&&a.click()},upload:function(b,c,d){var e=c||this.get("uploadURL"),f=d||this.get("postVarsPerFile"),g=b.get("id");f=f.hasOwnProperty(g)?f[g]:f,b instanceof a.FileHTML5&&(b.on("uploadstart",this._uploadEventHandler,this),b.on("uploadprogress",this._uploadEventHandler,this),b.on("uploadcomplete",this._uploadEventHandler,this),b.on("uploaderror",this._uploadEventHandler,this),b.on("uploadcancel",this._uploadEventHandler,this),b.startUpload(e,f,this.get("fileFieldName")))},uploadAll:function(a,b){this.uploadThese(this.get("fileList"),a,b)},uploadThese:function(b,c,d){if(this.queue)this.queue._currentState===e.UPLOADING&&(this.queue.set("perFileParameters",this.get("postVarsPerFile")),a.each(b,function(a){this.queue.addToQueueBottom(a)},this));else{var f=c||this.get("uploadURL"),g=d||this.get("postVarsPerFile");this.queue=new e({simUploads:this.get("simLimit"),errorAction:this.get("errorAction"),fileFieldName:this.get("fileFieldName"),fileList:b,uploadURL:f,perFileParameters:g,retryCount:this.get("retryCount"),uploadHeaders:this.get("uploadHeaders"),withCredentials:this.get("withCredentials")}),this.queue.on("uploadstart",this._uploadEventHandler,this),this.queue.on("uploadprogress",this._uploadEventHandler,this),this.queue.on("totaluploadprogress",this._uploadEventHandler,this),this.queue.on("uploadcomplete",this._uploadEventHandler,this),this.queue.on("alluploadscomplete",this._uploadEventHandler,this),this.queue.on("uploadcancel",this._uploadEventHandler,this),this.queue.on("uploaderror",this._uploadEventHandler,this),this.queue.startUpload(),this.fire("uploadstart")}}},{HTML5FILEFIELD_TEMPLATE:"<input type='file' style='visibility:hidden; width:0px; height: 0px;'>",SELECT_FILES_BUTTON:'<button type="button" class="yui3-button" role="button" aria-label="{selectButtonLabel}" tabindex="{tabIndex}">{selectButtonLabel}</button>',TYPE:"html5",NAME:"uploader",ATTRS:{appendNewFiles:{value:!0},buttonClassNames:{value:{hover:"yui3-button-hover",active:"yui3-button-active",disabled:"yui3-button-disabled",focus:"yui3-button-selected"}},dragAndDropArea:{value:null,setter:function(b){return a.one(b)}},enabled:{value:!0},errorAction:{value:"continue",validator:function(a){return a===e.CONTINUE||a===e.STOP||a===e.RESTART_ASAP||a===e.RESTART_AFTER}},fileFilters:{value:[]},fileFilterFunction:{value:null},fileFieldName:{value:"Filedata"},fileInputId:{value:null},fileList:{value:[],getter:"_getFileList",setter:"_setFileList"},multipleFiles:{value:!1},postVarsPerFile:{value:{}},selectButtonLabel:{value:"Select Files"},selectFilesButton:{valueFn:function(){return a.Node.create(d(a.UploaderHTML5.SELECT_FILES_BUTTON,{selectButtonLabel:this.get("selectButtonLabel"),tabIndex:this.get("tabIndex")}))}},simLimit:{value:2,validator:function(a){return a>=1&&a<=5}},uploadURL:{value:""},uploadHeaders:{value:{}},withCredentials:{value:!0},retryCount:{value:3}}}),a.UploaderHTML5.Queue=e},"3.14.1",{requires:["widget","node-event-simulate","file-html5","uploader-queue"]});
YUI.add("uploader",function(a,b){var c=a.config.win;c&&c.File&&c.FormData&&c.XMLHttpRequest?a.Uploader=a.UploaderHTML5:(a.namespace("Uploader"),a.Uploader.TYPE="none")},"3.14.1",{requires:["uploader-html5"]});
